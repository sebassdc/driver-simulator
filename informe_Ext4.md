# Ext4

Decidimos usar este sistema de archivos por varias razones:

- El cuarto sistema de archivos extendido denominado ext4, es un sistema de archivos con bitácora, es decir, es un sistema de archivos transaccional, en los cuales las transacciones en disco se escriben de manera secuencial en un área llamada journal o log, antes de ser escritas en sus localizaciones finales dentro del sistema de archivo. El ext4 fue concebido como una mejora compatible de ext3, el cual fue publicado como estable el 25 de diciembre de 2008 en la versión 2.6.28 del núcleo Linux y desde entonces se encuentra disponible para el uso en sistemas de producción.

- Este sistema de archivos ext4 es una notable mejora sobre ext3 mucho más de la que fue ext3 sobre ext2. Cuando la mayor mejora del sistema de archivos ext3 sobre ext2 fue añadir el soporte de bitácoras, ext4 modifica importantes estructuras de datos del sistema de archivos tales como aquellas destinadas a almacenar los archivos de datos. El resultado es un sistema de archivos con un mejorado diseño, mejores características, rendimiento y confiabilidad.

- Asimismo, otras mejoras del ext4 se refieren a que éste es capaz de trabajar con volúmenes de gran tamaño, hasta 1 exbabyte y ficheros de tamaño de hasta 16 TB; en éste, los extents, los cuales son conjuntos de bloques físicos contiguos que mejoran el rendimiento al trabajar con ficheros d gran tamaño y reden la fragmentación, han sido introducidos para reemplazar al tradicional esquema de bloques usado por los sistemas de archivos ext2/3; cualquier sistema ext3 existente puede ser montado como ext4 sin necesidad de cambios en el formato del disco.


- De la misma manera, el sistema de archivos ext4 permite la reserva de espacio en disco para un fichero. Hasta ahora la metodología consistía en rellenar el fichero en el disco con ceros en el momento de su creación; pues esta técnica ya no es necesaria, puesto que una nueva llamada del sistema "preallocate" ha sido añadida para uso de los sistemas de archivos que permitan esta función. El espacio reservado para estos ficheros quedará garantizado y con mucha probabilidad será contiguo. Esta función tiene útiles aplicaciones en streaming y bases de datos.

- No sólo eso, sino que también ext4 hace uso de una técnica de mejora de rendimiento llamada Allocate-on-flush, también conocida como reserva de memoria retrasada, la cual consiste en retrasar la reserva de bloques de memoria hasta que la información esté a punto de ser escrita en el disco, a diferencia de otros sistemas de archivos, los cuales reservan los bloques necesarios antes de ese paso. Esto mejora el rendimiento y reduce la fragmentación al mejorar las decisiones de reserva de memoria basada en el tamaño real del fichero.

- En éste, el límite de subdirectorios ha sido aumentado de 32000, como era en ext3 a 64000, con la posibilidad incluso ir más allá de este límite (haciendo uso de "dir_nlink"). Para permitir un rendimiento continuo, dada la posibilidad de directorios mucho más grandes, htree está activado por defecto en ext4. Además de esto, el ext4 usa checksums en el registro para mejorar la fiabilidad, puesto que el journal es uno de los ficheros más utilizados en el disco, función que tiene un efecto colateral beneficioso, el cual se refiere a que te permite de forma segura evitar una lectura/escritura de disco durante el proceso de registro en el journal, mejorando el rendimiento ligeramente(salva tiempo). Así mismo, dispone de una herramienta que permite desfragmentar ficheros individuales o sistemas de ficheros enteros sin desmontar el disco.

- Los grupos de bloques no asignados y secciones de la tabla de inodos, están marcados como tales. Esto permite a e2fsck, la versión de fsck para el sistema de archivos ext2, saltárselos completamente en las comprobaciones y en gran medida reduce el tiempo requerido para comprobar un sistema de archivos del tamaño para el que ext4 está preparado.

- Ext4 asigna múltiples bloques para un fichero en una sola operación, lo cual reduce la fragmentación al intentar elegir bloques contiguos en el disco. El asignador multibloque está activo cuando se usa 0_DIRECT o si la asignación retrasada está activa. Esto permite al fichero tener diversos bloques "sucios" solicitados para escritura al mismo tiempo, a diferencia del actual mecanismo del kernel de solicitud de envío de cada bloque al sistema de archivos de manera separada para su asignación.
Puesto que los ordenadores se tornan en general cada vez más rápidos y que Linux está pasando a ser cada vez más usado en aplicaciones críticas, la granularidad de los timestamps (también conocido como marca temporal, registro de tiempo o sello de tiempo), el cual es una secuencia de caracteres que representa una fecha y/u hora específicas, basados en segundos se está volviendo insuficiente. Para resolver esto, ext4 tendrá timestamps medidos en nanosegundos. Adicionalmente se han añadido 2 bits del timestamp extendido a los bits más significativos del campo de segundos de los timestamps para retrasar casi 500 años el problema del año 2038.

Se puede decir entonces, que ext4 es una mejora compatible de ext3 que utiliza menos CPU y mejora la velocidad de lectura y escritura. Además, soporta volúmenes de hasta 1024 PiB (PebiByte) (1 PiB = 2^50 Bytes). Como acabo de decir, mejora la velocidad de lectura y escritura en comparación con ext3, pero es más lento en la eliminación de archivos.

En ext4 se introducen los exents, que se utilizan para reemplazar al tradicional esquema de bloques utilizado por ext2 y ext3. Los exents mejoran el rendimiento al trabajar con ficheros de gran tamaño.

Esto hace ext4 un sistema de archivos ideal para nuestro sistema operativo.
